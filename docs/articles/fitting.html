<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="kDGLM">
<title>Fitting and analysing models • kDGLM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting and analysing models">
<meta property="og:description" content="kDGLM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">kDGLM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro.html">Notation</a>
    <a class="dropdown-item" href="../articles/structures.html">Creation of model structures</a>
    <a class="dropdown-item" href="../articles/outcomes.html">Creation of model outcomes</a>
    <a class="dropdown-item" href="../articles/fitting.html">Fitting and analysing models</a>
    <a class="dropdown-item" href="../articles/example1.html">Applied example: Space-time model hospital admissions from gastroenteritis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/silvaneojunior/kDGLM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fitting and analysing models</h1>
                        <h4 data-toc-skip class="author">Silvaneo V. dos
Santos Jr.</h4>
            
            <h4 data-toc-skip class="date">21 of February, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/silvaneojunior/kDGLM/blob/HEAD/vignettes/fitting.Rmd" class="external-link"><code>vignettes/fitting.Rmd</code></a></small>
      <div class="d-none name"><code>fitting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this section we briefly present the usage of the
<code>fit_model</code> function, along side the auxiliary functions for
analyzing a fitted model, such as the <code>summary</code>,
<code>coef</code>,<code>plot</code> and <code>forecast</code> methods,
the <code>plot_lat_var</code>, <code>plot_lin_pred</code> and
<code>dlm_sampling</code> functions. For a deep dive in the details of
each argument of each function, see the documentation of those function
and/or the reference manual.</p>
</div>
<div class="section level2">
<h2 id="filtering-and-smoothing">Filtering and smoothing<a class="anchor" aria-label="anchor" href="#filtering-and-smoothing"></a>
</h2>
<p>The usage of the <code>fit_model</code> function is as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  p_monit <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>...</code> argument receives <code>dlm_block</code> and
<code>dlm_distr</code> objects, whose creation was described in the
previous sections. In particular, if the user gives a
<code>dlm_distr</code> object as a named argument, its name is used as
the label for that outcome.</p>
<p><code>smooth</code> is a boolean indicating if the smoothed
distribution of the latent variables should be evaluated (generally we
recommend the users to not change this value, as the computational cost
of smoothing is almost always negligible).</p>
<p><code>p_monit</code> controls the sensibility of the automated
monitoring and we shall discuss its usage later on this section.</p>
<p>Bellow we present the code for a Poisson model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">level</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonic_block.html">harmonic_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, period <span class="op">=</span> <span class="fl">12</span>, order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Poisson.html">Poisson</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="st">"rate"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fitted.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span></span>
<span>  <span class="va">level</span>, <span class="va">season</span>, <span class="co"># Strucuture</span></span>
<span>  AirPassengers <span class="op">=</span> <span class="va">outcome</span> <span class="co"># oucome</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The first two lines create structural blocks representing a random
walk on <span class="math inline">\(\mu_t\)</span> and a seasonal
component described by harmonics. The fourth line creates a Poisson
outcome such that the rate parameter <code>lambda</code> is equal to
<span class="math inline">\(\exp\{\text{rate}\}\)</span>, since that was
the name given to the linear predictor when creating the structural
blocks (for details about the linear predictor see the previous
section). The last few lines receive the model structure and the Poisson
outcome and fits the model, obtaining the parameters for the filtered
and smoothed distribution of all latent states.</p>
<p>The user can see how the model fits the data using the
<code>plot</code> method, whose syntax is as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.fitted_dlm.html">plot.fitted_dlm</a></span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  pred.cred <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  lag <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">t</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  plot.pkg <span class="op">=</span> <span class="st">"auto"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>model</code> argument must be a <code>fitted_dlm</code>
object (i.e., the output of the <code>fit_model</code> function).</p>
<p><code>pred.cred</code> must be a number between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> representing the desired credibility of
the predictions.</p>
<p><code>lag</code> must be an integer representing the number of steps
ahead to be used for predictions. If <code>lag</code><span class="math inline">\(&lt;0\)</span>, the smoothed distribution is used
for predictions and, if <code>lag</code><span class="math inline">\(=0\)</span>, the filtered distribution is
used.</p>
<p><code>cutoff</code> must be an integer representing the number of
initial steps that should be skipped in the plot. Usually, the model is
still learning in the initial steps, so the predictions are not
reliable. The default value is one tenth of the sample size rounded
down.</p>
<p>Lastly <code>plot.pkg</code> must be a string specifing the plot
engine to be used. Should be one of <code>'auto'</code>,
<code>'base'</code>, <code>'ggplot2'</code> or <code>'plotly'</code>. If
<code>'auto'</code> is used, then the package will try to use
<code>plotly</code>, if it fails, then it tries to use
<code>ggplot2</code> and, if it also fails, then the package will use
the native functions provided by <code>R</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitted.data</span>, plot.pkg <span class="op">=</span> <span class="st">"base"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>For the sake of brevity, we will not detail the usage of the
remaining functions presented in this subsection, since they have
similar syntax to the <code>plot</code> method method of the
<code>fitted_dlm</code> class. We strongly advise the user to consult
the reference manual of this package and the documentation of each
function for detailed descriptions of any function.</p>
<p>To see a summary of the fitted model, one can use the
<code>summary</code> method:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitted.data</span><span class="op">)</span></span></code></pre></div>
<pre><code>Fitted DGLM with 1 outcomes.

distributions:
    AirPassengers: Poisson

Coeficients (smoothed) at time 144:
                Estimate Std. Error   t value Pr(&gt;|t|)
Var.Poly.Level   6.20799    0.01413 439.36382   &lt;1e-12 *** 
Var.Poly.Slope   0.00889    0.00052  17.05167   &lt;1e-12 *** 
Var.Sazo.Main.1 -0.15753    0.01196 -13.17551   &lt;1e-12 *** 
Var.Sazo.Aux.1  -0.07526    0.01225  -6.14283 8.11e-10 *** 
Var.Sazo.Main.2 -0.00841    0.01167  -0.72095    0.471   
Var.Sazo.Aux.2   0.08618    0.01197   7.19746   &lt;1e-12 *** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

---
One-step-ahead prediction
Log-likelihood        : -567.01085
Interval Score        :  102.96154
Mean Abs. Scaled Error:    0.43384
Relative abs. Error   :    0.05214
Mean Abs. Error       :   13.89588
Mean Squared Error    :  320.56218
---</code></pre>
<p>Notice that the coefficients shown are those of the last observation,
but one can also see the summary of any particular time by changing the
<code>t</code> argument:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitted.data</span>, t <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code>Fitted DGLM with 1 outcomes.

distributions:
    AirPassengers: Poisson

Coeficients (smoothed) at time 100:
                Estimate Std. Error   t value Pr(&gt;|t|)
Var.Poly.Level   5.84951    0.01089 537.00195   &lt;1e-12 *** 
Var.Poly.Slope   0.00889    0.00052  17.05167   &lt;1e-12 *** 
Var.Sazo.Main.1  0.01729    0.01032   1.67484    0.094   
Var.Sazo.Aux.1   0.16871    0.01009  16.72138   &lt;1e-12 *** 
Var.Sazo.Main.2 -0.06609    0.00995  -6.64074 3.12e-11 *** 
Var.Sazo.Aux.2  -0.05222    0.00999  -5.22925 1.70e-07 *** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

---
One-step-ahead prediction
Log-likelihood        : -567.01085
Interval Score        :  102.96154
Mean Abs. Scaled Error:    0.43384
Relative abs. Error   :    0.05214
Mean Abs. Error       :   13.89588
Mean Squared Error    :  320.56218
---</code></pre>
<p>For more details about the usage of the <code>summary</code> method
of the <code>fitted_dlm</code> class, see the associated documentation
(<code><a href="../reference/summary.fitted_dlm.html">help(summary.fitted_dlm)</a></code>).</p>
</div>
<div class="section level2">
<h2 id="extracting-components">Extracting components<a class="anchor" aria-label="anchor" href="#extracting-components"></a>
</h2>
<p>Naturally, the user may want to extract information about the
posterior distribution of the parameters of the fitted model, such that
a more thorough analysis may be performed. For extracting the parameters
of the distribution of latent states, linear predictors and
observational model parameters, one can use the <code>coef</code>
method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitted.coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitted.data</span><span class="op">)</span></span></code></pre></div>
<p>The output of this function is a <code>dlm_coef</code> object
containing:</p>
<ul>
<li><p><code>data</code>: A data frame with the model evaluated at each
observed time.</p></li>
<li><p><code>mt</code>: A <span class="math inline">\(n \times
T\)</span> matrix representing the mean of the latent variables at each
time, where <span class="math inline">\(n\)</span> is the number of
latent variables in the model and <span class="math inline">\(T\)</span>
is the length of the time series;</p></li>
<li><p><code>Ct</code>: A 3D-array containing the covariance matrix of
the latent variable at each time. Dimensions are <span class="math inline">\(n \times n \times T\)</span>;</p></li>
<li><p><code>ft</code>: A <span class="math inline">\(k \times
T\)</span> matrix representing the mean of the linear predictor at each
time, where <span class="math inline">\(k\)</span> is the number of
linear predictors in the model and <span class="math inline">\(T\)</span> is the length of the time
series;</p></li>
<li><p><code>Qt</code>: A 3D-array containing the covariance matrix for
the linear predictor at each time. Dimensions are <span class="math inline">\(k \times k \times T\)</span>;</p></li>
<li><p>Several vectors with some metrics, including the <strong>Mean
Absolute Error</strong> (MAE), the <strong>Mean Absolute Scaled
Error</strong> (MASE), the <strong>Relative Absolute Error</strong>
(RAE), the <strong>Mean Squared Error</strong> (MSE) and the
<strong>Interval Score</strong> (interval.score).</p></li>
<li><p><code>conj.param</code>: A list containing the conjugated
parameters for the distribution of the parameter of the observational
model.</p></li>
</ul>
<p>It is important to highlight that, following the method proposed in
<span class="citation">Alves et al. (<a href="#ref-ArtigokParametrico">2023</a>)</span>, the joint distribution
of the latent states (and the linear predictor) at each time is
Gaussian, such that the mean vector and covariance matrix completely
define their joint distribution.</p>
<p>The user may also want to plot the latent variables, for which the
<code>plot</code> method for the <code>dlm_coef</code> class can be
used:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitted.coef</span>, plot.pkg <span class="op">=</span> <span class="st">"base"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<pre><code><span><span class="cn">NULL</span></span></code></pre>
<p>If the user wants to see only a restricted set of latent variables,
the extra argument <code>var</code> can be used to specify the name of
the variable to plot:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitted.coef</span>, <span class="st">"Var.Poly.Level"</span>, plot.pkg <span class="op">=</span> <span class="st">"base"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<pre><code><span><span class="cn">NULL</span></span></code></pre>
<p>The user may also plot the linear predictors, by specifying the name
of the linear predictor:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitted.coef</span>, <span class="st">"rate"</span>, plot.pkg <span class="op">=</span> <span class="st">"base"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<pre><code><span><span class="cn">NULL</span></span></code></pre>
<p>Lastly, although we do not recommend it, the user may also extract
some of these information directly from the <code>fitted_dlm</code>
object.</p>
<p>We strongly recommend every user to consult the documentation of each
of these functions to see the full set of features provided by the
package.</p>
</div>
<div class="section level2">
<h2 id="forecasting">Forecasting<a class="anchor" aria-label="anchor" href="#forecasting"></a>
</h2>
<p>Notice that all methods and functions presented until now were
restricted to the period where the model was fitted. If the user wishes
make predictions for future observations, the <code>forecast</code>
method can be used:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/forecast.html">forecast</a></span><span class="op">(</span><span class="va">fitted.data</span>, <span class="fl">20</span>, plot <span class="op">=</span> <span class="st">"base"</span><span class="op">)</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<pre><code><span><span class="cn">NULL</span></span></code></pre>
<p>Additionally, the <code>forecast</code> method for the
<code>fitted_dlm</code> class also provides a similar set of attributes
of that which the <code>dlm_coef</code> class has, specifically, the
predictive distribution for the latent states, the linear predictors and
the observational model parameters, along with the predictions for
future observations.</p>
<p>It is relevant to point out that if external data is necessary for
forecasting, such as for models with regressive blocks or transfer
functions, it is necessary to pass those values for the
<code>forecast</code> method. In this scenario, the user must pass a new
argument named as the variable that is “missing” from the model. See the
documentation to see how to determine the name of the missing values or,
more practically, try to use the <code>forecast</code> method without
the necessary arguments, since the name of the missing variables will be
presented in the error message.</p>
<p>For more details on the usage of this function, see the associated
documentation (<code><a href="../reference/forecast.fitted_dlm.html">help(forecast.fitted_dlm)</a></code>).</p>
</div>
<div class="section level2">
<h2 id="updating-a-fitted-model">Updating a fitted model<a class="anchor" aria-label="anchor" href="#updating-a-fitted-model"></a>
</h2>
<p>One of the major advantages of the sequential nature of the
methodology proposed in <span class="citation">Alves et al. (<a href="#ref-ArtigokParametrico">2023</a>)</span> is that it allows for
the updating of the posterior distribution of the parameter when new
data arrives, but without the necessity of reprocessing the data
previously observed. This feature is particularly useful in problems
that involve monitoring or real time inference about a phenomena.</p>
<p>For updating a <code>fitted_dlm</code> object, the user can use the
<code>update</code> method for the <code>fitted_dlm</code> class:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/update.fitted_dlm.html">update.fitted_dlm</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>As one can imagine, the <code>model</code> argument must be a
<code>fitted_dlm</code> object. Moreover, the <code>...</code> argument
must be a sequence of named arguments containing the new information
observed. For example:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">level</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonic_block.html">harmonic_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, period <span class="op">=</span> <span class="fl">12</span>, order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="co"># Omitting the last 44 observations</span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Poisson.html">Poisson</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="st">"rate"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">fitted.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span></span>
<span>  <span class="va">level</span>, <span class="va">season</span>, <span class="co"># Strucuture</span></span>
<span>  AirPassengers <span class="op">=</span> <span class="va">outcome</span></span>
<span><span class="op">)</span> <span class="co"># outcome</span></span>
<span><span class="va">updated.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fitted.data</span>,</span>
<span>  AirPassengers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">[</span><span class="fl">101</span><span class="op">:</span><span class="fl">144</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>update</code> function may require extra arguments
containing covariates, pulses (for the transfer function), the offset,
etc.. In such cases, the syntax is the same as the <code>forecast</code>
method.</p>
</div>
<div class="section level2">
<h2 id="intervention-and-monitoring">Intervention and monitoring<a class="anchor" aria-label="anchor" href="#intervention-and-monitoring"></a>
</h2>
<p>As a key feature, the package has support for intervention and
automated monitoring. First, if the user is aware that at some specific
time there is some change in the time series that is not part of its
temporal dynamic, then the user should provide that information in the
model structure. For that we provide the <code>intervention</code>
function:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span></span>
<span><span class="co"># Adding an artificial change, so that we can make an intervention on the data at that point</span></span>
<span><span class="co"># Obviously, one should NOT change their own data.</span></span>
<span><span class="va">data</span><span class="op">[</span><span class="fl">60</span><span class="op">:</span><span class="fl">144</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fl">60</span><span class="op">:</span><span class="fl">144</span><span class="op">]</span> <span class="op">+</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">level</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonic_block.html">harmonic_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, period <span class="op">=</span> <span class="fl">12</span>, D <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reducing the discount factor so that the model can capture the expected change.</span></span>
<span><span class="va">level</span> <span class="op">&lt;-</span> <span class="va">level</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/intervention.html">intervention</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">60</span>, D <span class="op">=</span> <span class="fl">0.005</span>, var.index <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Comment the line above to see the fit without the intervention</span></span>
<span></span>
<span><span class="va">fitted.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">season</span>,</span>
<span>  AirPassengers <span class="op">=</span> <span class="fu"><a href="../reference/Poisson.html">Poisson</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="st">"rate"</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitted.data</span>, plot.pkg <span class="op">=</span> <span class="st">"base"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<pre><code><span><span class="cn">NULL</span></span></code></pre>
<p>See the documentation of the <code>intervention</code> function for
more details about its arguments. Also, we strongly recommend the user
to consult <span class="citation">West and Harrison (<a href="#ref-WestHarr-DLM">1997</a>)</span>, chapter 11 for a detailed
discussion about Feed-Foward Interventions.</p>
<p>In case the user is not aware of any behavioral changes in the data,
but suspects that they may have occurred at some unknown time, then we
recommend the use of automated monitoring.</p>
<p>To fit a model using automated monitoring, the user must provide a
valid value for the <code>p.monit</code> argument in the
<code>fit_model</code> function. This argument receives values between
<span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>, such that its value is interpreted as
the prior probability (i.e., the probability before observing the data),
at any given time, of behavioral change in the series that is not
accommodated by the temporal dynamic.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span></span>
<span><span class="co"># Adding an artificial change, so that we can make an intervention on the data at that point</span></span>
<span><span class="co"># Obviously, one should NOT change their own data.</span></span>
<span><span class="va">data</span><span class="op">[</span><span class="fl">60</span><span class="op">:</span><span class="fl">144</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fl">60</span><span class="op">:</span><span class="fl">144</span><span class="op">]</span> <span class="op">+</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">level</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonic_block.html">harmonic_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, period <span class="op">=</span> <span class="fl">12</span>, D <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fitted.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">season</span>,</span>
<span>  AirPassengers <span class="op">=</span> <span class="fu"><a href="../reference/Poisson.html">Poisson</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="st">"rate"</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>,</span>
<span>  p.monit <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitted.data</span>, plot.pkg <span class="op">=</span> <span class="st">"base"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<pre><code><span><span class="cn">NULL</span></span></code></pre>
<p>The approach used for automated monitoring is almost identical to
that of <span class="citation">West and Harrison (<a href="#ref-WestHarr-DLM">1997</a>)</span>, chapter 11.4, using Bayes’
factor, such that <code>p.monit</code><span class="math inline">\(=0.05\)</span> yields a threshold equivalent to
that recommended in <span class="citation">West and Harrison (<a href="#ref-WestHarr-DLM">1997</a>)</span>.</p>
</div>
<div class="section level2">
<h2 id="tools-for-sensibility-analysis">Tools for sensibility analysis<a class="anchor" aria-label="anchor" href="#tools-for-sensibility-analysis"></a>
</h2>
<p>In some situations, the user may not be sure about which value to use
for some hyperparameter of the model (such as the discount factor or the
order of a block) or about the inclusion of some structural block. As
such, one might choose to perform a sensibility analysis on the effect
of those choices. For such analysis, we provide the
<code>search_model</code> function.</p>
<p>As an motivational example, let us assume that we are unsure about
which value to choose for the discount factor in a polynomial trend
block of a Poisson model. First, when defining the model structure, we
must set the discount factor as a string, which will be used as the
label for the unspecified parameter:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">level</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="st">"D1"</span><span class="op">)</span></span></code></pre></div>
<p>By setting the discount factor as a string, the structural block
becomes partially <strong>undefined</strong>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span></span></code></pre></div>
<pre><code>Basic DLM block.
Latent variables: 
    Var.Poly: Level, Slope (2 variable(s))

Linear predictors: 
    rate

Status: undefined
Serie length: 1
Interventions at: 
Number of latent variables: 2
Number of linear predictors: 1</code></pre>
<p>As such, this block **can not* be used in the <code>fit_model</code>
function:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonic_block.html">harmonic_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, period <span class="op">=</span> <span class="fl">12</span>, D <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Poisson.html">Poisson</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="st">"rate"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fitted.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">season</span>, AirPassengers <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span></span></code></pre></div>
<pre><code>Error in fit_model(level, season, AirPassengers = outcome): Error: One or more hiper parameter are undefined. Did you meant to use the search_model function?</code></pre>
<p>As the user can see in the error message above, an undefined
<code>dlm_block</code> can only be used with the
<code>search_model</code> function. This function is used to fit a set
of models, while computing some comparative metrics.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/search_model.html">search_model</a></span><span class="op">(</span><span class="va">...</span>, <span class="va">search.grid</span>,</span>
<span>  condition <span class="op">=</span> <span class="st">"TRUE"</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"log.like"</span>, smooth <span class="op">=</span> <span class="cn">TRUE</span>, lag <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  pred.cred <span class="op">=</span> <span class="fl">0.95</span>, metric.cutoff <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  p.monit <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The usage of the <code>search_model</code> function is almost
identical to that of the <code>fit_model</code> function, the
<code>...</code>, <code>smooth</code> and <code>p.monit</code> arguments
having the exact same meaning.</p>
<p>The <code>search.grid</code> argument must be a list containing, for
each undefined parameter, the list of values to be tested. By default,
this function will test all possible combinations of the undefined
parameter. If the user wishes to skip some combinations, the
<code>condition</code> argument can be used to provide a string with the
criterion to determine which combinations shall be evaluated.</p>
<p>The remaining options provide some control over the comparative
metrics. The <code>metric</code> argument (<code>'mae'</code>,
<code>'mase'</code>, <code>'rae'</code>, <code>'log.like'</code> or
<code>'interval.score'</code>) indicates which metric to use when
selecting the best model (all metrics are calculated, not matter the
value of the <code>metric</code> argument, but only the best model by
the chosen metric is saved). The <code>lag</code> argument indicates the
number of steps ahead to be used for predictions (<span class="math inline">\(0\)</span> indicates filtered predictions and
negative values indicate smoothed predictions). The
<code>pred.cred</code> argument indicates the credibility of the
intervals used when computing the Interval Score. The
<code>metric.cutoff</code> argument indicates the number of initial
observations to be ignored when computing the metrics.</p>
<p>After evaluating all valid combinations of hyper parameters, the
<code>search_model</code> function returns the best model by the chosen
metric, along with a data frame containing the metrics for each model
evaluated.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">level</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="st">"D.level"</span><span class="op">)</span></span>
<span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonic_block.html">harmonic_block</a></span><span class="op">(</span></span>
<span>  rate <span class="op">=</span> <span class="st">"sazo.effect"</span>, period <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="st">"D.sazo"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Poisson.html">Poisson</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="st">"rate"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/search_model.html">search_model</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">season</span>, <span class="va">outcome</span>,</span>
<span>  search.grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    sazo.effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    D.level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span>, l <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>    D.sazo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">1</span>, l <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  condition <span class="op">=</span> <span class="st">"sazo.effect==1 | D.sazo==1"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>It is important to note that not all hyper parameters can be tested
directly by the search model function, indeed, only the components
associated with <span class="math inline">\(F_t\)</span>, <span class="math inline">\(D_t\)</span>, <span class="math inline">\(h_t\)</span>, <span class="math inline">\(H_t\)</span>, <span class="math inline">\(a_1\)</span> and <span class="math inline">\(R_1\)</span> can be treated as undefined. Still,
if the user wants to test some other hyper parameter that cannot be
tested directly (such as the order of a polynomial block or the period
of a harmonic block), he can create one block for each option and
perform a sensibility analysis for the inclusion/exclusion of each
block:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a block for each order</span></span>
<span><span class="va">level</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"pol.ord.1"</span>, order <span class="op">=</span> <span class="fl">1</span>, D <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"pol.ord.2"</span>, order <span class="op">=</span> <span class="fl">2</span>, D <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"pol.ord.3"</span>, order <span class="op">=</span> <span class="fl">3</span>, D <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"pol.ord.4"</span>, order <span class="op">=</span> <span class="fl">4</span>, D <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonic_block.html">harmonic_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, period <span class="op">=</span> <span class="fl">12</span>, D <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Poisson.html">Poisson</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="st">"rate"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/search_model.html">search_model</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">season</span>, <span class="va">outcome</span>,</span>
<span>  search.grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Each block can be present (1) or absent (0).</span></span>
<span>    pol.ord.1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, pol.ord.2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    pol.ord.3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, pol.ord.4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  condition <span class="op">=</span> <span class="st">"pol.ord.1+pol.ord.2+pol.ord.3+pol.ord.4==1"</span></span>
<span>  <span class="co"># Only test combinations with exactly one polynomial block.</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sampling-and-hyper-parameter-estimation">Sampling and hyper parameter estimation<a class="anchor" aria-label="anchor" href="#sampling-and-hyper-parameter-estimation"></a>
</h2>
<p>Lastly, one may also want to draw samples from the latent states,
linear predictors and/or the parameters <span class="math inline">\(\eta_t\)</span> of the observational model. This
can be useful to evaluate non-linear functions of the model parameters
or when the DGLM is only a part of a bigger model, from which the
parameters are being estimated with Gibbs Algorithm. It is important to
note that, with the method proposed in <span class="citation">Alves et
al. (<a href="#ref-ArtigokParametrico">2023</a>)</span>, sampling from
the posterior distribution of the latent states is straight forward,
allowing the user to obtain large independent (<strong>not</strong>
approximately independent, but <strong>exactly independent</strong>
samples with very low computational cost. See <span class="citation">West and Harrison (<a href="#ref-WestHarr-DLM">1997</a>)</span>, chapter 15, for details about
the sampling algorithm.</p>
<p>Our package offers the <code>dlm_sampling</code> function, which
provides a routine for drawing independent samples from any fitted
model:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dlm_sampling.html">dlm_sampling</a></span><span class="op">(</span><span class="va">fitted.data</span>, <span class="fl">5000</span><span class="op">)</span></span></code></pre></div>
<p>For the example above, where our model has <span class="math inline">\(6\)</span> latent states and <span class="math inline">\(144\)</span> observations (which yields a total of
<span class="math inline">\(864\)</span> parameters), it takes
approximately <span class="math inline">\(0.3\)</span> seconds to draw a
sample of size <span class="math inline">\(5.000\)</span>.</p>
<p>Another useful feature of our package is that it provides an
approximate value for the Model likelihood <span class="math inline">\(f(y)=
\int_{\mathbb{R}^{n}}f(y|\theta)f(\theta)d\theta\)</span>, where <span class="math inline">\(y\)</span> represents the values for <span class="math inline">\(Y_t\)</span> for all <span class="math inline">\(t\)</span> and <span class="math inline">\(\theta\)</span> represents the values of <span class="math inline">\(\theta_t\)</span> for all <span class="math inline">\(t\)</span>. This feature can be used for two main
purposes: to compare different models and to evaluate the posterior
distribution of hyper parameter.</p>
<p>To compare different models, <span class="math inline">\(\mathcal{M}_1,...,\mathcal{M}_k\)</span> , one can
note that <span class="math inline">\(f(\mathcal{M}_i|y) \propto
f(y|\mathcal{M}_i)f(\mathcal{M}_i)\)</span>, where <span class="math inline">\(f(y|\mathcal{M}_i)=
\int_{\mathbb{R}^{n}}f(y|\theta,\mathcal{M}_i)f(\theta|\mathcal{M}_i)d\theta\)</span>
is the likelihood of model <span class="math inline">\(\mathcal{M}_i\)</span> and <span class="math inline">\(f(\mathcal{M}_i)\)</span> is the prior for model
<span class="math inline">\(\mathcal{M}_i\)</span>. To evaluate <span class="math inline">\(f(y|\mathcal{M}_i)\)</span>, one can make use of
the <code>coef</code> method, the <code>eval_dlm_norm_const</code>
function or <code>search_model</code> function by setting
<code>lag</code> to a negative number (the log likelihood metric will be
<span class="math inline">\(\ln f(y|\mathcal{M}_i)\)</span>). Similarly,
if the user wants to obtain the marginal posterior distribution of an
hyper parameter <span class="math inline">\(\tau\)</span>, it can
observe that <span class="math inline">\(f(\tau|y) \propto
f(y|\tau)f(\tau)\)</span>, from which <span class="math inline">\(f(y|\tau)\)</span> can be evaluated using the
<code>coef</code> method, the <code>eval_dlm_norm_const</code> function
or <code>search_model</code> function.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H.range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, l <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">log.like.H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">H.range</span><span class="op">)</span></span>
<span><span class="va">log.prior.H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="va">H.range</span>, <span class="fl">0</span>, <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">H.range</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">level</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polynomial_block.html">polynomial_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, H <span class="op">=</span> <span class="va">H.range</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonic_block.html">harmonic_block</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span>, period <span class="op">=</span> <span class="fl">12</span>, D <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span>  <span class="co"># Using only 10 observations, for the sake of a pretty plot. For this particular application, the posterior density of H rapidly becomes highly consentrated in a single value.</span></span>
<span>  <span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Poisson.html">Poisson</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="st">"rate"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">fitted.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">season</span>, <span class="va">outcome</span><span class="op">)</span></span>
<span>  <span class="va">log.like.H</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval_dlm_norm_const.html">eval_dlm_norm_const</a></span><span class="op">(</span><span class="va">fitted.data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">log.post.H</span> <span class="op">&lt;-</span> <span class="va">log.prior.H</span> <span class="op">+</span> <span class="va">log.like.H</span></span>
<span><span class="va">post.H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log.post.H</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">log.post.H</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">H.range</span>, <span class="va">post.H</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"H"</span>, ylab <span class="op">=</span> <span class="st">"f(H|y)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ArtigokParametrico" class="csl-entry">
Alves, Mariane Branco, Helio S. Migon, Raíra Marotta, and Silvaneo V.
dos Santos Jr. au2. 2023. <span>“K-Parametric Dynamic Generalized Linear
Models: A Sequential Approach via Information Geometry.”</span> arXiv.
<a href="https://doi.org/10.48550/ARXIV.2201.05387" class="external-link">https://doi.org/10.48550/ARXIV.2201.05387</a>.
</div>
<div id="ref-WestHarr-DLM" class="csl-entry">
West, Mike, and Jeff Harrison. 1997. <em>Bayesian Forecasting and
Dynamic Models (Springer Series in Statistics)</em>. Hardcover;
Springer-Verlag.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Silvaneo dos Santos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
